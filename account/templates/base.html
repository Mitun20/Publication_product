{% load custom_filters %}
{% load static %}
<!DOCTYPE html>
<html lang="zxx">  
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="{% static 'assets/css/bootstrap.min.css'%}">
        <!-- Owl Carousel CSS -->
        <link rel="stylesheet" href="{% static 'assets/css/owl.carousel.min.css'%}">
        <!-- Owl Carousel Theme Default CSS -->
        <link rel="stylesheet" href="{% static 'assets/css/owl.theme.default.min.css'%}">
        <!-- Box Icon CSS-->
        <link rel="stylesheet" href="{% static 'assets/css/boxicons.min.css'%}">
        <!-- Flaticon CSS-->
        <link rel="stylesheet" href="{% static 'assets/fonts/flaticon/flaticon.css'%}">
        <!-- Magnific CSS -->
        <link rel="stylesheet" href="{% static 'assets/css/magnific-popup.css'%}">
        <!-- Meanmenu CSS -->
        <link rel="stylesheet" href="{% static 'assets/css/meanmenu.css'%}">
        <!-- Nice Select CSS -->
        <link rel="stylesheet" href="{% static 'assets/css/nice-select.css'%}">
        <!-- Style CSS -->
        <link rel="stylesheet" href="{% static 'assets/css/style.css'%}">
		<!-- Dark CSS -->
        <link rel="stylesheet" href="{% static 'assets/css/dark.css'%}">
		<!-- Responsive CSS -->
		<link rel="stylesheet" href="{% static 'assets/css/responsive.css'%}">
        <!-- Title CSS -->
        <title>Manuscript Flow</title>
        <!-- Favicon -->
        <link rel="icon" type="image/png" href="{% static 'assets/img/favicon.png'%}"> 
        <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
        <!-- Head section -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

        <!-- End of body section -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

        <!-- jQuery first, then Bootstrap JS -->
        <script src="{% static 'assets/js/jquery.min.js'%}"></script>
        <script src="{% static 'assets/js/bootstrap.bundle.min.js'%}"></script>
    </head>
    <style>
        /* Chatbot Widget Styles */
    .chatbot-widget {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1000;
    }

    .chatbot-toggle {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: #044d5e;
        color: white;
        border: none;
        cursor: pointer;
        font-size: 24px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        transition: all 0.3s ease;
    }

    .chatbot-toggle:hover {
        background: #044d5e;
        transform: scale(1.1);
    }

    .chatbot-container {
        width: 350px;
        height: 550px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        display: none;
        flex-direction: column;
        overflow: hidden;
    }

    .chatbot-header {
        background: #044d5e;
        color: white;
        padding: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .chatbot-close {
        background: none;
        border: none;
        color: white;
        font-size: 20px;
        cursor: pointer;
    }

    .chatbot-messages {
        flex: 1;
        padding: 15px;
        overflow-y: auto;
        background: #f9f9f9;
    }

    .chatbot-input {
        display: flex;
        padding: 10px;
        border-top: 1px solid #ddd;
        background: white;
    }

    .chatbot-input input {
        flex: 1;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }

    .chatbot-input button {
        margin-left: 10px;
        padding: 10px 15px;
        background: #044d5e;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    /* Message styles */
    .chat-message {
        margin-bottom: 10px;
        padding: 8px 12px;
        border-radius: 18px;
        max-width: 80%;
    }

    .user-message {
        background: #e3f2fd;
        margin-left: auto;
        border-bottom-right-radius: 0;
    }

    .bot-message {
        background: #f1f1f1;
        margin-right: auto;
        border-bottom-left-radius: 0;
    }
 /* Add these styles to your CSS */
 
    
    .chatbot-history {
        background: none;
        border: none;
        color: white;
        font-size: 16px;
        cursor: pointer;
        padding: 5px;
    }
    
    .chatbot-history-panel {
        display: none;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: white;
        padding: 15px;
        z-index: 10;
        overflow-y: auto;
    }
    
    .chatbot-history-panel h4 {
        margin-top: 0;
        color: #044d5e;
    }
    
    .history-list {
        max-height: 80%;
        overflow-y: auto;
        margin: 10px 0;
    }
    

    
    .close-history {
        background: #044d5e;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 4px;
        cursor: pointer;
    }
    /* Add to your <style> block */
    .history-item {
        background: #f9f9f9;
        border-radius: 6px;
        margin-bottom: 12px;
        padding: 10px;
        box-shadow: 0 1px 2px rgba(0,0,0,0.03);
    }
    </style>
    <body>
         
        <!-- Pre-loader Start -->
           <!-- Pre-loader Start -->
    <div class="loader-content">
        <div class="d-table">
            <div class="d-table-cell">
                <div class="sk-circle">
                    <div class="sk-circle1 sk-child"></div>
                    <div class="sk-circle2 sk-child"></div>
                    <div class="sk-circle3 sk-child"></div>
                    <div class="sk-circle4 sk-child"></div>
                    <div class="sk-circle5 sk-child"></div>
                    <div class="sk-circle6 sk-child"></div>
                    <div class="sk-circle7 sk-child"></div>
                    <div class="sk-circle8 sk-child"></div>
                    <div class="sk-circle9 sk-child"></div>
                    <div class="sk-circle10 sk-child"></div>
                    <div class="sk-circle11 sk-child"></div>
                    <div class="sk-circle12 sk-child"></div>
                </div>
            </div>
        </div>
    </div>
    <!-- Pre-loader End -->
    <section class="topbar">
        <!-- <marquee>Donec maximus, magna at imperdiet sodales, odio turpis vehicula magna, sed varius felis orci quis
            velit. </marquee> -->
            Manuscript Flow ISSN: XXXX â€“ XXXX (Print), XXXX â€“ XXXX (Online)
    </section>
    <section class="bgwhitesec"></section>
        <div class="container">
            <div class="header-section">
                <div class="hs"> <a class="navbar-brand" href="{% url 'index' %}">
                        <img src="{% static 'assets/img/logo.png'%}" alt="logo">
                    </a>
                </div>
            </div>
        </div>
    </section>
    <!-- Navbar Area Start -->

 
    <!-- Menu For Desktop Device -->

    {% if user.is_superuser or user.groups.exists %}    
        <div class="navbar-area sublinks text-center">
            <div class="container">
                <nav class="navbar navbar-expand-lg navbar-light">
                    <div class="collapse navbar-collapse mean-menu" id="navbarSupportedContent">
                        <ul class="navbar-nav">
                            <li class="nav-item">
                                <a href="{% url 'index' %}" class="nav-link">Home</a>
                            </li>
                            {% if user.is_superuser %}
                            <li class="nav-item">
                                <a href="{% url 'user_management' %}" class="nav-link">User Management</a>
                            </li>
                            {% endif %}
                            {% for group in user.groups.all %}
                            {% if group.name == 'AE' %}
                            <li class="nav-item">
                                <a href="{% url 'associate_editor' %}" class="nav-link">Associate Editor</a>
                            </li>
                            
                        {% elif group.name == 'EIC' %}
                            <li class="nav-item">
                                <a href="{% url 'editor_in_chief' %}" class="nav-link">Editor in Chief</a>
                            </li>
                            
                        {% elif group.name == 'Author' %}
                            <li class="nav-item">
                                <a href="{% url 'startnew' %}" class="nav-link">Author</a>
                            </li>
                            
                        {% elif group.name == 'Reviewer' %}
                            <li class="nav-item">
                                <a href="{% url 'reviewer_invitations' %}" class="nav-link">Reviewer</a>
                            </li>
                            
                        {% elif group.name == 'Admin Office' %}
                            <li class="nav-item">
                                <a href="{% url 'admin_office' %}" class="nav-link">Admin Office</a>
                            </li>
                        {% endif %}
                    {% endfor %}
                            
                            
                        </ul>
                        <!-- Right-aligned items -->
                        <ul class="navbar-nav ml-auto">
                        <!-- {% for group in user.groups.all %}
                     
                    
                        {% endfor %} -->
                        {% for group in user.groups.all %}
                            
                            {% if group.name == 'AE' or group.name == 'EIC' %}
                                <li class="nav-item ae-eic" >
                                    <a href="{% url 'editor_profile' %}" class="nav-link">Editor Profile</a>
                                </li>
                                {% endif %}
                            {% if group.name == 'Author' or group.name == 'Reviewer' %}
                                <li class="nav-item author-reviewer">
                                    <a href="{% url 'profile' %}" class="nav-link">Profile</a>
                                </li>
                            {% endif %}
                        {% endfor %}
                            <li class="nav-item">
                                <a href="{% url 'change_password' %}" class="nav-link">Change Password</a>
                            </li>
                            
                            <li class="nav-item">
                                <a href="{% url 'logout' %}" class="nav-link">Logout</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
        </div>
    {% endif %}       
        <!-- Navbar Area End -->    
        <!-- Navbar Area End -->

         <!-- Sign In Section Start -->
       <!-- In your base.html head section -->
        <!-- Add this anywhere in your base.html -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <!-- In head section -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
<!-- Before closing </body> -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Add this to your base.html -->
<div class="chatbot-widget">
    <button class="chatbot-toggle">
        <i class="fas fa-robot"></i>
    </button>
    <div class="chatbot-container">
        <div class="chatbot-header">
            <h4 style="color: white;">Publication Assistant</h4>
            
            <div class="chatbot-header-icons">
                <button class="chatbot-history" title="View History"><i class="fas fa-history"></i></button>
            </div>
            
            <div class="chatbot-header-icons">
                <button class="chatbot-close">&times;</button>
            </div>
        </div>
        <div class="chatbot-history-panel" id="chatbotHistory">
            <h4>Conversation History</h4>
            <div class="history-list" id="historyList"></div>
            <button class="close-history">Close History</button>
        </div>
        <div class="chatbot-messages" id="chatbotMessages">
            <div style="display: flex; align-items: center; background:#e6ebee; border:1px solid #eaecec; border-radius:8px; padding:15px 20px; max-width:400px; font-family:Arial, sans-serif; font-size:1.1rem; color:#333;">
            <span style="font-size: 1.8rem; margin-right: 12px;">ðŸ¤–</span>
            <span>Hi! I am here to assist you, how can I help you?</span>
            </div>
<br>
            <!-- Active messages appear here -->
        </div>
        <div class="chatbot-input">
            <input type="text" id="chatbotInput" placeholder="Ask about the project...">
            <button id="chatbotSend">Send</button>
        </div>
    </div>
</div>


<script>
document.addEventListener('DOMContentLoaded', function() {
    // Chatbot widget variables
    const toggleBtn = document.querySelector('.chatbot-toggle');
    const closeBtn = document.querySelector('.chatbot-close');
    const chatContainer = document.querySelector('.chatbot-container');
    const chatMessages = document.getElementById('chatbotMessages');
    const chatInput = document.getElementById('chatbotInput');
    const sendBtn = document.getElementById('chatbotSend');

    // History panel variables
    const historyBtn = document.querySelector('.chatbot-history');
    const historyPanel = document.getElementById('chatbotHistory');
    const historyList = document.getElementById('historyList');
    const closeHistoryBtn = document.querySelector('.close-history');

    // Toggle chat window
    toggleBtn.addEventListener('click', function() {
        chatContainer.style.display = 'flex';
        toggleBtn.style.display = 'none';
    });

    // Close chat window
    closeBtn.addEventListener('click', function() {
        chatContainer.style.display = 'none';
        toggleBtn.style.display = 'block';
    });

    // Show history panel and fetch history from server
    historyBtn.addEventListener('click', function() {
        historyPanel.style.display = 'block';
        fetch('/chat/history/', {
            method: 'GET',
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                renderHistoryFromServer(data.history);
            } else {
                historyList.innerHTML = '<p>Could not load history.</p>';
            }
        })
        .catch(() => {
            historyList.innerHTML = '<p>Error loading history.</p>';
        });
    });

    // Close history panel
    closeHistoryBtn.addEventListener('click', function() {
        historyPanel.style.display = 'none';
    });

    // Render history items from server
    function renderHistoryFromServer(history) {
        historyList.innerHTML = '';
        if (!history.length) {
            historyList.innerHTML = '<p>No conversation history yet.</p>';
            return;
        }
        history.forEach(item => {
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item';
            historyItem.innerHTML = `
                <div style="margin-bottom: 8px;">
                    <div><span style="color:#2196F3;"><strong>You:</strong></span> ${escapeHtml(item.question)}</div>
                    <span style="font-size: 1rem; margin-right: 10px;">ðŸ¤–:</span> ${escapeHtml(item.answer)}</div>
                    <div style="text-align:right;"><small style="color:#888;">${item.created_at}</small></div>
                </div>
            `;
            historyList.appendChild(historyItem);
        });
    }

    // Send message to server and display response
    sendBtn.addEventListener('click', sendMessage);
    chatInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            sendMessage();
        }
    });

    function sendMessage() {
        const message = chatInput.value.trim();
        if (message) {
            addMessage(message, 'user');
            chatInput.value = '';
            fetch('/chat/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRFToken': getCookie('csrftoken'),
                    'X-Requested-With': 'XMLHttpRequest'
                },
                body: `question=${encodeURIComponent(message)}`
            })
            .then(response => response.json())
            .then(data => {
                addMessage(data.answer, 'bot');
            })
            .catch(error => {
                addMessage("Sorry, I'm having trouble connecting.", 'bot');
                console.error('Error:', error);
            });
        }
    }

    // Add message to chat window
    function addMessage(text, sender) {
        const msgDiv = document.createElement('div');
        msgDiv.className = 'chat-message ' + (sender === 'user' ? 'user-message' : 'bot-message');
        // Render newlines as <br> for bot messages
        if (sender === 'bot') {
            msgDiv.innerHTML = text.replace(/\n/g, '<br>');
        } else {
            msgDiv.textContent = text;
        }
        chatMessages.appendChild(msgDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Escape HTML to prevent XSS
    function escapeHtml(text) {
        var div = document.createElement('div');
        div.appendChild(document.createTextNode(text));
        return div.innerHTML;
    }

    // Get CSRF token from cookie
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
});
</script>

 
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>



                    {% block content %}


                    {% endblock %}

        <!-- Sign In Section End -->

       <!-- Footer Section Start -->
       <footer class="footer-area pt-70 pb-50">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-3 col-sm-6">
                    <div class="footer-widget">
                        <div class="footer-logo">
                            <a href="{% url 'index' %}">
                                <img src="{% static 'assets/img/logo-ftr.png'%}" alt="logo">
                            </a>
                        </div>

                        <p>Manuscript flow refers to the complete lifecycle of a research paper, including submission, initial screening, peer review, revision, editorial decision, and final publication. This structured process ensures the integrity, quality, and timely communication of scholarly work.</p>

                        <div class="footer-social" style="display: none;">
                            <a href="https://www.facebook.com/login/" target="_blank"><i
                                    class='bx bxl-facebook'></i></a>
                            <a href="https://twitter.com/i/flow/login" target="_blank"><i
                                    class='bx bxl-twitter'></i></a>
                            <a href="https://www.pinterest.com/" target="_blank"><i
                                    class='bx bxl-pinterest-alt'></i></a>
                            <a href="https://www.linkedin.com/" target="_blank"><i class='bx bxl-linkedin'></i></a>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3 col-sm-6">
                    <div class="footer-widget pl-60">
                        <h3>Quick Links</h3>
                        <ul>
                            <li>
                                <a href="{% url 'review_board_jcs' %}">
                                    <i class='bx bx-chevrons-right bx-tada'></i>
                                    Review Board
                                </a>
                            </li>
                            <li>
                                <a href="{% static '/downloads/paper-template-jcs.pdf'%}" target="_blank">
                                    <i class='bx bx-chevrons-right bx-tada'></i>
                                    Paper Template
                                </a>
                            </li>
                            <!-- <li>
                                <a href="#">
                                    <i class='bx bx-chevrons-right bx-tada'></i>
                                    Abstracting and Indexing
                                </a>
                            </li> -->
                            <li>
                                <a href="{% url 'plagiarism_policy_jcs' %}">
                                    <i class='bx bx-chevrons-right bx-tada'></i>
                                    Plagiarism Policy
                                </a>
                            </li>
                            <li>
                                <a href="{% static '/downloads/copyright-jcs.pdf'%}" target="_blank">
                                    <i class='bx bx-chevrons-right bx-tada'></i>
                                   Copyright
                                </a>
                            </li>
                            <li>
                                <a href="{% url 'faq_karpagam_jcs' %}">
                                    <i class='bx bx-chevrons-right bx-tada'></i>
                                    FAQ
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="col-lg-3 col-sm-6">
                    <div class="footer-widget pl-60">
                        <h3>Policy</h3>
                        <ul>
                            <li>
                                <a href="{% url 'publication_fees' %}">
                                    <i class='bx bx-chevrons-right bx-tada'></i>
                                    Online Payment
                                </a>
                            </li>
                            <li>
                                {% if user.is_authenticated %}
                            {% for group in user.groups.all %}
                                {% if group.name == 'Author' %}
                                <a href="{% url 'startnew' %}">
                                    <i class='bx bx-chevrons-right bx-tada'></i>
                                    Online Paper Submission
                                </a>
                                {% else %}
                                <a href="{% url 'startnew' %}">
                                    <i class='bx bx-chevrons-right bx-tada'></i>
                                    Online Paper Submission
                                </a>
                                {% endif %}
                            {% endfor %}
                        {% else %}
                        <a href="{% url 'startnew' %}">
                            <i class='bx bx-chevrons-right bx-tada'></i>
                            Online Paper Submission
                        </a>
                            
                        {% endif %}
                            
                                
                            </li>
                            <li>
                                <a href="{% url 'terms_and_conditions' %}">
                                    <i class='bx bx-chevrons-right bx-tada'></i>
                                   Terms & Conditions
                                </a>
                            </li>
                            <li>
                                <a href="{% url 'reviewer_policy_jcs' %}">
                                    <i class='bx bx-chevrons-right bx-tada'></i>
                                    Reviewer Policy
                                </a>
                            </li>
                            
                        </ul>
                    </div>
                </div>

                <div class="col-lg-3 col-sm-6">
                    <div class="footer-widget footer-info">
                        <h3>Information</h3>
                        <ul>
                            <li>
                                <span>
                                    <i class='bx bxs-phone'></i>
                                    <a href="tel:4222980014"  style="padding-left: 0px;">
                                        +91-422-54654656
                                    </a>
                                </span>
                               
                            </li>

                            <li>
                                <span>
                                    <i class='bx bxs-envelope'></i>
                                    <a href="mailto:jcs@kahedu.edu.in" style="padding-left: 0px;">
                                        abc@manuscriptflow.com
                                    </a>
                                </span>
                               
                            </li>

                            <li>
                                <span>
                                    <i class='bx bx-location-plus'></i>
                                    Address:
                                </span>

                                abc Post, <br>City â€“ XXX XXX,
                                <br>State, Country.
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <div class="copyright-text text-center">
        <p>Copyright Â© year Manuscript Flow. Concept by <a href="https://irepute.in/" target="_blank">repute</a>
        </p>
    </div>
    <!-- Footer Section End -->

        <!-- Back To Top Start -->
		<div class="top-btn">
			<i class='bx bx-chevrons-up bx-fade-up'></i>
		</div>
		<!-- Back To Top End -->

		<!-- jQuery first, then Bootstrap JS -->
		<script src="{% static 'assets/js/jquery.min.js'%}"></script>
        <script>
            $(document).ready(function(){
    // Select all elements with the class name '.your-class'
    var elements = $('.ae-eic');
    
    // Check if there is a second element
    if (elements.length > 1) {
        // Remove the second element (index 1 in zero-based indexing)
        elements.eq(1).remove();
    }
    var elements = $('.author-reviewer');
    
    // Check if there is a second element
    if (elements.length > 1) {
        // Remove the second element (index 1 in zero-based indexing)
        elements.eq(1).remove();
    }
});

        </script>
		<script src="{% static 'assets/js/bootstrap.bundle.min.js'%}"></script>
		<!-- Owl Carousel JS -->
		<script src="{% static 'assets/js/owl.carousel.min.js'%}"></script>
		<!-- Nice Select JS -->
		<script src="{% static 'assets/js/jquery.nice-select.min.js'%}"></script>
		<!-- Magnific Popup JS -->
		<script src="{% static 'assets/js/jquery.magnific-popup.min.js'%}"></script>
		<!-- Subscriber Form JS -->
		<script src="{% static 'assets/js/jquery.ajaxchimp.min.js'%}"></script>
		<!-- Form Velidation JS -->
		<script src="{% static 'assets/js/form-validator.min.js'%}"></script>
		<!-- Contact Form -->
		<script src="{% static 'assets/js/contact-form-script.js'%}"></script>
		<!-- Meanmenu JS -->
		<script src="{% static 'assets/js/meanmenu.js'%}"></script>
		<!-- Custom JS -->
		<script src="{% static 'assets/js/custom.js'%}"></script>
  	</body>
</html>